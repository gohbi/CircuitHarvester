<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Circuit Harvester - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Space Grotesk', sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .circuit-pattern {
        background-image: radial-gradient(#334155 1px, transparent 1px);
        background-size: 24px 24px;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }
      @keyframes scan {
        0% { top: 10%; opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { top: 90%; opacity: 0; }
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-out;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    
    <!-- React from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <script>
      // ============================================
      // CIRCUIT HARVESTER DEMO
      // Single-file demo version with mock analysis
      // ============================================

      const { useState, useRef, useEffect, createElement: h } = React;
      
      // Create icon components from lucide SVG paths
      const createIcon = (pathData, viewBox = "0 0 24 24") => {
        return ({ className = "", size = 24 }) => {
          return h('svg', {
            className: className,
            width: size,
            height: size,
            viewBox: viewBox,
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2,
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
            dangerouslySetInnerHTML: { __html: pathData }
          });
        };
      };

      // Icon SVG paths from Lucide
      const Icons = {
        Cpu: createIcon('<rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/>'),
        RotateCcw: createIcon('<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>'),
        AlertTriangle: createIcon('<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>'),
        Lightbulb: createIcon('<path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/>'),
        Box: createIcon('<path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/>'),
        Check: createIcon('<polyline points="20 6 9 17 4 12"/>'),
        Zap: createIcon('<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>'),
        ShoppingCart: createIcon('<circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>'),
        X: createIcon('<path d="M18 6 6 18"/><path d="m6 6 12 12"/>'),
        Printer: createIcon('<polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/>'),
        FileDown: createIcon('<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/>'),
        Database: createIcon('<ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/>'),
        Camera: createIcon('<path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/>'),
        Upload: createIcon('<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/>'),
        Loader2: createIcon('<path d="M21 12a9 9 0 1 1-6.219-8.56"/>'),
        ShieldCheck: createIcon('<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/>')
      };

      // ============================================
      // DEMO DATA - Sample circuit board analysis
      // ============================================
      
      // Sample circuit board image (SVG diagram of Arduino UNO, base64-encoded)
      // This is an 800x600 SVG showing a stylized PCB with labeled components
      const DEMO_IMAGE = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iNjAwIiB2aWV3Qm94PSIwIDAgODAwIDYwMCI+CiAgPHJlY3Qgd2lkdGg9IjgwMCIgaGVpZ2h0PSI2MDAiIGZpbGw9IiMwYTNkMmEiLz4KICA8IS0tIFBDQiBUcmFjZXMgLS0+CiAgPGcgc3Ryb2tlPSIjYzBhMDIwIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPgogICAgPHBhdGggZD0iTTUwIDEwMCBIMjAwIFYyMDAgSDM1MCBWNDI1IiAvPgogICAgPHBhdGggZD0iTTIwMCAxMDAgVjUwIEg1MDAgVjE1MCIgLz4KICAgIDxwYXRoIGQ9Ik01MDAgMTUwIEg2NTAgVjMwMCIgLz4KICAgIDxwYXRoIGQ9Ik02NTAgMzAwIEg1NTAgVjQ1MCIgLz4KICAgIDxwYXRoIGQ9Ik0xMDAgNTAwIEgzMDAgVjM1MCBINDU1IiAvPgogICAgPHBhdGggZD0iTTQ1MCA0MDAgSDY1MCBWNTI1IiAvPgogIDwvZz4KICA8IS0tIE1haW4gQ2hpcCAtLT4KICA8cmVjdCB4PSIzMDAiIHk9IjIwMCIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiMyMDIwMjAiIHN0cm9rZT0iIzQwNDA0MCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPHRleHQgeD0iNDAwIiB5PSIyNzAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkFUbWVnYTMyOFAtUFU8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSIyOTAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM4ODgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk1pY3JvY29udHJvbGxlcjwvdGV4dD4KICA8IS0tIENoaXAgUGlucyAtLT4KICA8ZyBmaWxsPSIjYzBhMDIwIj4KICAgIDxyZWN0IHg9IjMxMCIgeT0iMTkwIiB3aWR0aD0iOCIgaGVpZ2h0PSIxMCIvPgogICAgPHJlY3QgeD0iMzMwIiB5PSIxOTAiIHdpZHRoPSI4IiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSIzNTAiIHk9IjE5MCIgd2lkdGg9IjgiIGhlaWdodD0iMTAiLz4KICAgIDxyZWN0IHg9IjM3MCIgeT0iMTkwIiB3aWR0aD0iOCIgaGVpZ2h0PSIxMCIvPgogICAgPHJlY3QgeD0iMzkwIiB5PSIxOTAiIHdpZHRoPSI4IiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI0MTAiIHk9IjE5MCIgd2lkdGg9IjgiIGhlaWdodD0iMTAiLz4KICAgIDxyZWN0IHg9IjQzMCIgeT0iMTkwIiB3aWR0aD0iOCIgaGVpZ2h0PSIxMCIvPgogICAgPHJlY3QgeD0iNDUwIiB5PSIxOTAiIHdpZHRoPSI4IiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI0NzAiIHk9IjE5MCIgd2lkdGg9IjgiIGhlaWdodD0iMTAiLz4KICA8L2c+CiAgPCEtLSBDYXBhY2l0b3JzIC0tPgogIDxjaXJjbGUgY3g9IjE1MCIgY3k9IjMwMCIgcj0iMjUiIGZpbGw9IiMxMDEwMTAiIHN0cm9rZT0iI2MwYTAyMCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPHRleHQgeD0iMTUwIiB5PSIzMDQiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MTAwMHVGPC90ZXh0PgogIDxjaXJjbGUgY3g9IjE1MCIgY3k9IjQyMCIgcj0iMjAiIGZpbGw9IiMxMDEwMTAiIHN0cm9rZT0iI2MwYTAyMCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPHRleHQgeD0iMTUwIiB5PSI0MjQiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iNyIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+NDcwdUY8L3RleHQ+CiAgPCEtLSBDcnlzdGFsIC0tPgogIDxyZWN0IHg9IjU1MCIgeT0iMjAwIiB3aWR0aD0iNjAiIGhlaWdodD0iMjUiIGZpbGw9IiNjMGMwYzAiIHJ4PSI1Ii8+CiAgPHRleHQgeD0iNTgwIiB5PSIyMTYiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MTZNSHo8L3RleHQ+CiAgPCEtLSBVU0IgQ29ubmVjdG9yIC0tPgogIDxyZWN0IHg9IjUwIiB5PSI0MjAiIHdpZHRoPSI1MCIgaGVpZ2h0PSIzNSIgZmlsbD0iI2NjYyIgcng9IjMiLz4KICA8cmVjdCB4PSI1NSIgeT0iNDI4IiB3aWR0aD0iNDAiIGhlaWdodD0iMjAiIGZpbGw9IiMzMzMiLz4KICA8dGV4dCB4PSI3NSIgeT0iNDcwIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjgiIGZpbGw9IiM4ODgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlVTQi1CPC90ZXh0PgogIDwhLS0gTEVEcyAtLT4KICA8Y2lyY2xlIGN4PSI2NTAiIGN5PSI0NTAiIHI9IjgiIGZpbGw9IiMwMGZmMDAiIG9wYWNpdHk9IjAuOCIvPgogIDxjaXJjbGUgY3g9IjY4MCIgY3k9IjQ1MCIgcj0iOCIgZmlsbD0iI2ZmMDAwMCIgb3BhY2l0eT0iMC44Ii8+CiAgPHRleHQgeD0iNjY1IiB5PSI0NzUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iIzg4OCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TDwvdGV4dD4KICA8IS0tIFZvbHRhZ2UgUmVndWxhdG9yIC0tPgogIDxyZWN0IHg9IjYwMCIgeT0iMTAwIiB3aWR0aD0iNTAiIGhlaWdodD0iMzAiIGZpbGw9IiMyMDIwMjAiLz4KICA8cmVjdCB4PSI2MTAiIHk9IjY1IiB3aWR0aD0iMzAiIGhlaWdodD0iMzUiIGZpbGw9IiM0MDQwNDAiLz4KICA8dGV4dCB4PSI2MjUiIHk9IjE0NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSI4IiBmaWxsPSIjODg4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5MTTc4MDU8L3RleHQ+CiAgPCEtLSBSZXNpc3RvcnMgLS0+CiAgPGcgZmlsbD0iIzhlNDQyNCI+CiAgICA8cmVjdCB4PSI0MDAiIHk9IjQyMCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjEyIiByeD0iMiIvPgogICAgPHJlY3QgeD0iNDQwIiB5PSI0MjAiIHdpZHRoPSIzMCIgaGVpZ2h0PSIxMiIgcng9IjIiLz4KICAgIDxyZWN0IHg9IjQ4MCIgeT0iNDIwIiB3aWR0aD0iMzAiIGhlaWdodD0iMTIiIHJ4PSIyIi8+CiAgPC9nPgogIDwhLS0gSGVhZGVyIFBpbnMgLS0+CiAgPGcgZmlsbD0iIzIwMjAyMCI+CiAgICA8cmVjdCB4PSI3MDAiIHk9IjE1MCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjIwIi8+CiAgICA8cmVjdCB4PSI3MDAiIHk9IjE4MCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjIwIi8+CiAgICA8cmVjdCB4PSI3MDAiIHk9IjIxMCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjIwIi8+CiAgPC9nPgogIDx0ZXh0IHg9IjczMCIgeT0iMjUwIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjgiIGZpbGw9IiM4ODgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdQSU88L3RleHQ+CiAgPCEtLSBCb2FyZCBMYWJlbCAtLT4KICA8dGV4dCB4PSI0MDAiIHk9IjU1MCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QVJEVUlOTyBVTk8gUjM8L3RleHQ+Cjwvc3ZnPg==";

      // Sample analysis result matching the format from geminiService.ts
      // box_2d coordinates: [ymin, xmin, ymax, xmax] on a 0-1000 scale
      // These are normalized coordinates relative to the image dimensions
      const DEMO_ANALYSIS = {
        deviceName: "Arduino UNO R3 Clone",
        deviceFunction: "An open-source microcontroller development board based on the ATmega328P chip. Used for prototyping electronics projects, learning programming, and building interactive devices. This board provides 14 digital I/O pins, 6 analog inputs, USB connectivity, and can be powered via USB or external power supply.",
        estimatedAge: "2010s - Modern",
        safetyWarnings: [
          "Disconnect power before removing components to avoid short circuits",
          "The voltage regulator can get hot during extended use - allow cooling before handling",
          "Electrostatic discharge (ESD) can damage ICs - ground yourself before handling chips"
        ],
        parts: [
          {
            name: "ATmega328P-PU Microcontroller",
            type: "Microcontroller (IC)",
            description: "8-bit AVR RISC-based microcontroller with 32KB flash memory, 2KB SRAM, and 1KB EEPROM. The brain of the Arduino that runs your sketches.",
            harvestability: "High",
            projectIdeas: [
              "Standalone Arduino on a breadboard",
              "Custom minimal Arduino clone",
              "Learning bare-metal AVR programming"
            ],
            box_2d: [333, 375, 583, 625]
          },
          {
            name: "16MHz Crystal Oscillator",
            type: "Timing Component",
            description: "Provides the clock signal for the microcontroller, determining the speed at which instructions are executed.",
            harvestability: "High",
            projectIdeas: [
              "Precision timing circuits",
              "RF projects requiring stable frequency",
              "Clock source for other microcontrollers"
            ],
            box_2d: [333, 687, 375, 762]
          },
          {
            name: "1000µF Electrolytic Capacitor",
            type: "Passive (Capacitor)",
            description: "Large filtering capacitor that smooths power supply voltage and reduces electrical noise. Essential for stable operation.",
            harvestability: "High",
            projectIdeas: [
              "Audio amplifier power filtering",
              "LED driver smoothing",
              "Power supply stabilization"
            ],
            box_2d: [458, 156, 542, 219]
          },
          {
            name: "LM7805 Voltage Regulator",
            type: "Power Management",
            description: "Linear voltage regulator that converts input voltage (7-12V) to stable 5V output for the board components.",
            harvestability: "High",
            projectIdeas: [
              "5V power supply for any project",
              "Battery-powered device regulator",
              "USB charging circuit"
            ],
            box_2d: [108, 750, 217, 812]
          },
          {
            name: "USB Type-B Connector",
            type: "Connector",
            description: "Standard USB-B port for programming and powering the board from a computer.",
            harvestability: "Medium",
            projectIdeas: [
              "USB interface for custom PCBs",
              "Replacement port for printers/devices",
              "USB-powered project enclosure"
            ],
            box_2d: [700, 62, 758, 125]
          },
          {
            name: "Status LEDs (Power + TX/RX)",
            type: "Indicator",
            description: "SMD LEDs indicating power status and serial communication activity.",
            harvestability: "Low",
            projectIdeas: [
              "Indicator lights for DIY projects",
              "Status displays in enclosures",
              "LED throwies or art installations"
            ],
            box_2d: [733, 812, 767, 862]
          },
          {
            name: "GPIO Header Pins",
            type: "Connector",
            description: "Male header pins providing access to all digital and analog I/O pins of the microcontroller.",
            harvestability: "High",
            projectIdeas: [
              "Breadboard-friendly connections",
              "Custom shield connectors",
              "Prototype board interfaces"
            ],
            box_2d: [250, 875, 383, 950]
          }
        ]
      };

      // ============================================
      // ANNOTATED IMAGE COMPONENT
      // ============================================
      
      const AnnotatedImage = ({ imageSrc, parts, onPartClick }) => {
        const [hoveredIndex, setHoveredIndex] = useState(null);

        return h('div', { 
          className: "relative w-full rounded-xl overflow-hidden bg-slate-900 border border-slate-700 shadow-xl group"
        },
          h('img', { 
            src: imageSrc, 
            alt: "Analyzed Circuit", 
            className: "w-full h-auto block"
          }),
          parts.map((part, index) => {
            if (!part.box_2d || part.box_2d.length !== 4) return null;

            const [ymin, xmin, ymax, xmax] = part.box_2d;
            const top = (ymin / 1000) * 100 + '%';
            const left = (xmin / 1000) * 100 + '%';
            const height = ((ymax - ymin) / 1000) * 100 + '%';
            const width = ((xmax - xmin) / 1000) * 100 + '%';
            const isHovered = hoveredIndex === index;

            return h('button', {
              key: index,
              type: "button",
              onClick: () => onPartClick && onPartClick(index),
              className: `absolute border-2 transition-all duration-300 cursor-pointer
                ${isHovered ? 'border-emerald-400 bg-emerald-400/20 z-20' : 'border-emerald-500/60 z-10 hover:border-emerald-400 hover:bg-emerald-400/10'}`,
              style: { top, left, width, height },
              onMouseEnter: () => setHoveredIndex(index),
              onMouseLeave: () => setHoveredIndex(null),
              'aria-label': `Select part ${index + 1}: ${part.name}`
            },
              h('div', {
                className: `absolute -top-3 -left-3 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shadow-lg transition-transform duration-200
                  ${isHovered ? 'bg-emerald-400 text-slate-900 scale-125 z-30' : 'bg-emerald-600 text-white z-20'}`
              }, index + 1),
              h('div', {
                className: `absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-3 py-1.5 bg-slate-900/95 text-white text-xs whitespace-nowrap rounded border border-slate-700 shadow-xl pointer-events-none transition-opacity duration-200 z-30
                  ${isHovered ? 'opacity-100' : 'opacity-0'}`
              }, 
                h('span', { className: "font-bold text-emerald-400" }, `${index + 1}. `),
                part.name
              )
            );
          })
        );
      };

      // ============================================
      // ANALYSIS DISPLAY COMPONENT
      // ============================================
      
      const AnalysisDisplay = ({ result }) => {
        const [selectedIndices, setSelectedIndices] = useState(new Set());
        const [showShoppingList, setShowShoppingList] = useState(false);

        const toggleSelection = (index) => {
          const newSelection = new Set(selectedIndices);
          if (newSelection.has(index)) {
            newSelection.delete(index);
          } else {
            newSelection.add(index);
          }
          setSelectedIndices(newSelection);
        };

        const selectedParts = result.parts.filter((_, i) => selectedIndices.has(i));

        const handlePrint = () => {
          const printWindow = window.open('', '_blank', 'height=800,width=800');
          if (!printWindow) return;

          const itemsHtml = selectedParts.map((part, idx) => `
            <tr>
              <td>${idx + 1}</td>
              <td>
                <div class="part-name">${part.name}</div>
                <div class="part-desc">${part.description}</div>
              </td>
              <td><span class="badge">${part.type}</span></td>
              <td style="text-align: center;"><div class="checkbox"></div></td>
            </tr>
          `).join('');

          const htmlContent = `
            <!DOCTYPE html>
            <html>
              <head>
                <title>Shopping List - ${result.deviceName}</title>
                <style>
                  @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
                  body { font-family: 'Space Grotesk', sans-serif; padding: 40px; color: #1e293b; }
                  h1 { color: #0f172a; margin: 0 0 10px 0; font-size: 24px; }
                  .meta { color: #64748b; font-size: 14px; border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 30px; }
                  table { width: 100%; border-collapse: collapse; }
                  th { text-align: left; padding: 12px 8px; border-bottom: 2px solid #cbd5e1; color: #475569; text-transform: uppercase; font-size: 12px; }
                  td { padding: 16px 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
                  .part-name { font-weight: 600; }
                  .part-desc { font-size: 13px; color: #64748b; margin-top: 4px; }
                  .badge { display: inline-block; padding: 4px 8px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 11px; }
                  .checkbox { width: 18px; height: 18px; border: 2px solid #cbd5e1; border-radius: 4px; margin: 0 auto; }
                  .footer { margin-top: 50px; padding-top: 20px; border-top: 1px solid #e2e8f0; text-align: center; font-size: 12px; color: #94a3b8; }
                </style>
              </head>
              <body>
                <h1>${result.deviceName}</h1>
                <div class="meta"><strong>Function:</strong> ${result.deviceFunction}<br><strong>Generated:</strong> ${new Date().toLocaleDateString()}</div>
                <table>
                  <thead><tr><th width="40">#</th><th>Component Details</th><th width="140">Type</th><th width="60" style="text-align: center">Check</th></tr></thead>
                  <tbody>${itemsHtml}</tbody>
                </table>
                <div class="footer">Generated by CircuitHarvester • Build new things with old toys</div>
                <script>window.onload = function() { setTimeout(() => { window.print(); }, 500); }</script>
              </body>
            </html>
          `;

          printWindow.document.write(htmlContent);
          printWindow.document.close();
        };

        const handleExportWord = () => {
          // Generate a simple HTML document compatible with Microsoft Word
          const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Shopping List</title></head><body>";
          const footer = "</body></html>";
          
          const rows = selectedParts.map((part, i) => `
            <tr>
              <td style="border-bottom:1px solid #ddd; padding:10px;">${i + 1}</td>
              <td style="border-bottom:1px solid #ddd; padding:10px;">
                <b>${part.name}</b><br/>
                <span style="color:#666; font-size:0.9em;">${part.description}</span>
              </td>
              <td style="border-bottom:1px solid #ddd; padding:10px;">${part.type}</td>
              <td style="border-bottom:1px solid #ddd; padding:10px; text-align:center;">[ ]</td>
            </tr>
          `).join('');

          const content = `
            <h1 style="color:#333;">${result.deviceName} - Parts List</h1>
            <p><i>${result.deviceFunction}</i></p>
            <br/>
            <table style="width:100%; border-collapse:collapse; text-align:left;">
              <thead style="background-color:#f5f5f5;">
                <tr>
                  <th style="border-bottom:2px solid #999; padding:10px;">#</th>
                  <th style="border-bottom:2px solid #999; padding:10px;">Component</th>
                  <th style="border-bottom:2px solid #999; padding:10px;">Type</th>
                  <th style="border-bottom:2px solid #999; padding:10px;">Check</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          `;
          
          const sourceHTML = header + content + footer;
          const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
          const fileDownload = document.createElement("a");
          document.body.appendChild(fileDownload);
          fileDownload.href = source;
          fileDownload.download = 'parts-list-' + result.deviceName.replace(/\s+/g, '-').toLowerCase() + '.doc';
          fileDownload.click();
          document.body.removeChild(fileDownload);
        };

        return h('div', { className: "w-full max-w-4xl mx-auto space-y-8 animate-fadeIn pb-24" },
          // Device Overview Header
          h('div', { className: "bg-slate-800/80 backdrop-blur-sm border border-slate-700 rounded-2xl p-6 md:p-8 shadow-xl relative overflow-hidden" },
            h('div', { className: "absolute top-0 right-0 p-4 opacity-10" },
              h(Icons.Cpu, { size: 120 })
            ),
            h('div', { className: "relative z-10" },
              h('div', { className: "flex flex-col md:flex-row md:items-end justify-between gap-4 mb-4" },
                h('div', null,
                  h('h2', { className: "text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400" },
                    result.deviceName
                  ),
                  result.estimatedAge && h('span', { className: "inline-block mt-2 px-3 py-1 bg-slate-700 rounded-full text-xs font-medium text-slate-300 uppercase tracking-wider" },
                    `Era: ${result.estimatedAge}`
                  )
                )
              ),
              h('p', { className: "text-slate-300 text-lg leading-relaxed max-w-2xl" },
                result.deviceFunction
              )
            )
          ),

          // Safety Warnings
          result.safetyWarnings.length > 0 && h('div', { className: "bg-amber-950/40 border border-amber-900/50 rounded-xl p-4 flex gap-4 items-start" },
            h(Icons.AlertTriangle, { className: "text-amber-500 shrink-0 mt-1" }),
            h('div', null,
              h('h3', { className: "text-amber-400 font-bold mb-1" }, "Safety First"),
              h('ul', { className: "list-disc list-inside text-amber-200/80 text-sm space-y-1" },
                result.safetyWarnings.map((warning, idx) => h('li', { key: idx }, warning))
              )
            )
          ),

          // Harvestable Parts Grid
          h('div', { className: "space-y-4" },
            h('div', { className: "flex items-center justify-between mb-6" },
              h('div', { className: "flex items-center gap-2" },
                h(Icons.Box, { className: "text-emerald-400" }),
                h('h3', { className: "text-2xl font-bold text-white" }, "Harvestable Components")
              ),
              h('p', { className: "text-sm text-slate-400 hidden md:block" }, "Select items to build a shopping list")
            ),
            h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
              result.parts.map((part, index) => {
                const isSelected = selectedIndices.has(index);
                return h('div', {
                  key: index,
                  id: `part-${index}`,
                  onClick: () => toggleSelection(index),
                  className: `group cursor-pointer relative overflow-hidden rounded-xl p-5 transition-all duration-300 flex flex-col h-full border 
                    ${isSelected 
                      ? 'bg-slate-800 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.2)]' 
                      : 'bg-slate-800 border-slate-700 hover:border-slate-500'}`
                },
                  // Selection Checkbox
                  h('div', {
                    className: `absolute top-4 right-4 w-6 h-6 rounded-md border-2 flex items-center justify-center transition-colors z-20
                      ${isSelected ? 'bg-emerald-500 border-emerald-500' : 'border-slate-600 group-hover:border-slate-400'}`
                  }, isSelected && h(Icons.Check, { className: "w-4 h-4 text-white" })),

                  // Index Watermark
                  h('div', { className: "absolute top-2 right-12 text-6xl font-bold text-slate-700/20 pointer-events-none select-none" }, index + 1),

                  h('div', { className: "flex justify-between items-start mb-3 relative z-10" },
                    h('div', { className: "flex items-center gap-3" },
                      h('div', {
                        className: `w-8 h-8 rounded-full border flex items-center justify-center font-bold text-sm transition-colors
                          ${isSelected ? 'bg-emerald-500 text-white border-emerald-500' : 'bg-emerald-500/10 text-emerald-400 border-emerald-500/30'}`
                      }, index + 1),
                      h('div', { className: "bg-slate-900 rounded-lg p-2 border border-slate-700" },
                        h(Icons.Zap, { className: "w-4 h-4 text-cyan-400" })
                      )
                    )
                  ),

                  h('div', { className: "pr-8" },
                    h('h4', { className: `text-xl font-bold mb-1 transition-colors relative z-10 ${isSelected ? 'text-emerald-400' : 'text-white'}` }, part.name),
                    h('p', { className: "text-slate-400 text-xs font-mono mb-3 relative z-10" }, part.type)
                  ),

                  h('p', { className: "text-slate-300 text-sm mb-4 flex-grow relative z-10" }, part.description),

                  h('div', { className: "mt-auto pt-4 border-t border-slate-700/50 relative z-10" },
                    h('div', { className: "flex items-center gap-2 mb-2" },
                      h(Icons.Lightbulb, { className: "w-4 h-4 text-amber-400" }),
                      h('span', { className: "text-xs font-bold text-amber-400 uppercase" }, "Project Ideas")
                    ),
                    h('ul', { className: "space-y-1" },
                      part.projectIdeas.map((idea, i) => h('li', { key: i, className: "text-sm text-slate-400 pl-2 border-l-2 border-slate-700" }, idea))
                    )
                  )
                );
              })
            )
          ),

          // Floating Action Bar
          h('div', {
            className: `fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-800 border border-slate-700 text-white px-6 py-3 rounded-full shadow-2xl transition-all duration-300 z-40 flex items-center gap-4
              ${selectedIndices.size > 0 ? 'translate-y-0 opacity-100' : 'translate-y-24 opacity-0 pointer-events-none'}`
          },
            h('span', { className: "font-bold text-emerald-400" }, `${selectedIndices.size} selected`),
            h('div', { className: "h-4 w-px bg-slate-600" }),
            h('button', {
              onClick: () => setShowShoppingList(true),
              className: "flex items-center gap-2 hover:text-emerald-400 transition-colors"
            },
              h(Icons.ShoppingCart, { className: "w-5 h-5" }),
              h('span', { className: "font-medium" }, "View List")
            )
          ),

          // Shopping List Modal
          showShoppingList && h('div', { className: "fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4 backdrop-blur-sm" },
            h('div', { className: "bg-white text-slate-900 w-full max-w-2xl max-h-[90vh] rounded-2xl flex flex-col shadow-2xl" },
              // Modal Header
              h('div', { className: "p-6 border-b border-slate-200 flex justify-between items-center bg-slate-50 rounded-t-2xl" },
                h('div', null,
                  h('h3', { className: "text-2xl font-bold flex items-center gap-2" },
                    h(Icons.ShoppingCart, { className: "text-emerald-600" }),
                    "Project Shopping List"
                  ),
                  h('p', { className: "text-slate-500 text-sm mt-1" }, `Parts harvested from ${result.deviceName}`)
                ),
                h('button', {
                  onClick: () => setShowShoppingList(false),
                  className: "text-slate-400 hover:text-slate-600 transition-colors p-2 hover:bg-slate-100 rounded-full"
                }, h(Icons.X, { className: "w-6 h-6" }))
              ),

              // Content
              h('div', { className: "flex-1 overflow-y-auto p-6" },
                h('div', { className: "space-y-6" },
                  // Info Box
                  h('div', { className: "bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm text-blue-800 flex gap-3" },
                    h(Icons.Lightbulb, { className: "w-5 h-5 text-blue-600 shrink-0" }),
                    h('p', null, "Use this list to verify specs for connectors (like pin pitch, voltage) or to find compatible add-ons for your projects.")
                  ),
                  h('table', { className: "w-full text-left border-collapse" },
                    h('thead', null,
                      h('tr', { className: "border-b-2 border-slate-200" },
                        h('th', { className: "py-3 px-2 text-sm font-bold text-slate-500 uppercase" }, "#"),
                        h('th', { className: "py-3 px-2 text-sm font-bold text-slate-500 uppercase" }, "Component"),
                        h('th', { className: "py-3 px-2 text-sm font-bold text-slate-500 uppercase" }, "Type / Specs"),
                        h('th', { className: "py-3 px-2 text-sm font-bold text-slate-500 uppercase w-12 text-center" }, "Chk")
                      )
                    ),
                    h('tbody', null,
                      selectedParts.map((part, idx) => h('tr', { key: idx, className: "border-b border-slate-100 last:border-0 hover:bg-slate-50" },
                        h('td', { className: "py-4 px-2 font-mono text-slate-400 text-sm align-top" }, idx + 1),
                        h('td', { className: "py-4 px-2 align-top" },
                          h('div', { className: "font-bold text-slate-900" }, part.name),
                          h('div', { className: "text-sm text-slate-500 mt-1" }, part.description)
                        ),
                        h('td', { className: "py-4 px-2 align-top" },
                          h('span', { className: "inline-block px-2 py-1 bg-slate-100 rounded text-xs font-medium text-slate-600 border border-slate-200" }, part.type)
                        ),
                        h('td', { className: "py-4 px-2 text-center align-top" },
                          h('div', { className: "w-5 h-5 border-2 border-slate-300 rounded mx-auto" })
                        )
                      ))
                    )
                  )
                )
              ),

              // Modal Footer
              h('div', { className: "p-6 border-t border-slate-200 bg-slate-50 rounded-b-2xl flex flex-col sm:flex-row justify-between items-center gap-4" },
                h('span', { className: "text-sm text-slate-500 hidden sm:inline" }, `${selectedParts.length} items ready for export`),
                h('div', { className: "flex flex-wrap gap-3 w-full sm:w-auto justify-end" },
                  h('button', {
                    onClick: () => setShowShoppingList(false),
                    className: "px-4 py-3 rounded-xl border border-slate-300 text-slate-700 font-bold hover:bg-white hover:border-slate-400 transition-all text-sm"
                  }, "Close"),
                  h('button', {
                    onClick: handleExportWord,
                    className: "px-4 py-3 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-500 shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 text-sm"
                  },
                    h(Icons.FileDown, { className: "w-4 h-4" }),
                    "Export .docx"
                  ),
                  h('button', {
                    onClick: handlePrint,
                    className: "px-4 py-3 rounded-xl bg-emerald-600 text-white font-bold hover:bg-emerald-500 shadow-lg shadow-emerald-200 transition-all flex items-center justify-center gap-2 text-sm"
                  },
                    h(Icons.Printer, { className: "w-4 h-4" }),
                    "Print / PDF"
                  )
                )
              )
            )
          )
        );
      };

      // ============================================
      // CAMERA MODAL COMPONENT
      // ============================================
      
      const CameraModal = ({ onCapture, onClose }) => {
        const [error, setError] = useState(null);
        const [isCapturing, setIsCapturing] = useState(false);
        
        const handleCapture = () => {
          setIsCapturing(true);
          // Simulate capture delay with flash effect, then trigger demo
          setTimeout(() => {
            onCapture();
          }, 800);
        };

        return h('div', { className: "fixed inset-0 z-50 bg-black bg-opacity-95 flex flex-col items-center justify-center p-4" },
          h('div', { className: "w-full max-w-md relative bg-slate-900 rounded-2xl overflow-hidden border border-slate-700 shadow-2xl" },
            // Header
            h('div', { className: "flex justify-between items-center p-4 bg-slate-800" },
              h('h3', { className: "text-white font-semibold flex items-center gap-2" },
                h(Icons.Camera, { className: "w-5 h-5 text-emerald-400" }),
                "Scanner"
              ),
              h('button', { 
                onClick: onClose, 
                className: "text-slate-400 hover:text-white transition-colors" 
              },
                h(Icons.X, { className: "w-6 h-6" })
              )
            ),

            // Camera View (simulated with circuit pattern)
            h('div', { className: "relative aspect-[3/4] bg-black overflow-hidden" },
              // Simulated camera feed with circuit pattern
              h('div', { 
                className: "absolute inset-0 circuit-pattern opacity-30",
                style: { backgroundSize: '12px 12px' }
              }),
              h('div', { className: "absolute inset-0 flex items-center justify-center" },
                h('div', { className: "text-center text-slate-500" },
                  h(Icons.Camera, { className: "w-16 h-16 mx-auto mb-4 opacity-50" }),
                  h('p', { className: "text-sm" }, "Camera Preview"),
                  h('p', { className: "text-xs text-slate-600 mt-1" }, "(Demo Mode)")
                )
              ),
              
              // Scanning Overlay Animation
              h('div', { className: "absolute inset-0 border-2 border-emerald-500/30 pointer-events-none" },
                h('div', { 
                  className: "absolute left-8 right-8 h-0.5 bg-emerald-500/80 shadow-[0_0_15px_rgba(16,185,129,0.8)]",
                  style: { animation: 'scan 2s ease-in-out infinite' }
                })
              ),

              // Flash effect on capture
              isCapturing && h('div', { className: "absolute inset-0 bg-white animate-pulse" })
            ),

            // Capture Button
            h('div', { className: "p-6 bg-slate-800 flex justify-center" },
              h('button', {
                onClick: handleCapture,
                disabled: isCapturing,
                className: "w-16 h-16 rounded-full border-4 border-white flex items-center justify-center bg-emerald-500 hover:bg-emerald-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-[0_0_20px_rgba(16,185,129,0.4)]"
              },
                h('div', { className: "w-14 h-14 rounded-full border-2 border-slate-800" })
              )
            )
          )
        );
      };

      // ============================================
      // MAIN APP COMPONENT
      // ============================================

      const App = () => {
        const [state, setState] = useState({
          isLoading: false,
          error: null,
          result: null,
          image: null
        });
        const [showCamera, setShowCamera] = useState(false);
        const fileInputRef = useRef(null);

        const handleLoadDemo = () => {
          setState({ isLoading: true, error: null, result: null, image: null });
          
          // Simulate loading delay for effect
          setTimeout(() => {
            setState({
              isLoading: false,
              error: null,
              result: DEMO_ANALYSIS,
              image: DEMO_IMAGE
            });
          }, 1500);
        };

        const handleCameraCapture = () => {
          setShowCamera(false);
          handleLoadDemo();
        };

        const handleFileUpload = () => {
          // In demo mode, just load the demo data
          handleLoadDemo();
        };

        const handleReset = () => {
          setState({
            isLoading: false,
            error: null,
            result: null,
            image: null
          });
        };

        const scrollToPart = (index) => {
          const element = document.getElementById(`part-${index}`);
          if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        };

        return h('div', { className: "min-h-screen bg-slate-900 text-slate-200 selection:bg-emerald-500/30" },
          h('div', { className: "circuit-pattern fixed inset-0 opacity-20 pointer-events-none" }),
          
          // Header
          h('header', { className: "fixed top-0 left-0 right-0 z-40 bg-slate-900/80 backdrop-blur-md border-b border-slate-700" },
            h('div', { className: "max-w-6xl mx-auto px-4 h-16 flex items-center justify-between" },
              h('div', { className: "flex items-center gap-2" },
                h('div', { className: "bg-emerald-500 p-1.5 rounded-lg" },
                  h(Icons.Cpu, { className: "text-slate-900 w-6 h-6" })
                ),
                h('span', { className: "font-bold text-xl tracking-tight text-white" },
                  "Circuit",
                  h('span', { className: "text-emerald-400" }, "Harvester")
                ),
                h('span', { className: "ml-2 px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs font-bold rounded-full border border-amber-500/30" }, "DEMO")
              ),
              h('div', { className: "flex items-center gap-4" },
                // Status Indicator
                state.result && h('div', { className: "hidden md:flex items-center gap-2 text-xs font-medium" },
                  h(Icons.Database, { className: "w-3 h-3 text-slate-500" }),
                  h('span', { className: "text-slate-500" }, "Research Data Synced")
                ),
                state.result && h('button', {
                  onClick: handleReset,
                  className: "flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-600 transition-all text-sm font-medium"
                },
                  h(Icons.RotateCcw, { className: "w-4 h-4" }),
                  h('span', { className: "hidden sm:inline" }, "New Scan")
                )
              )
            )
          ),

          // Main Content
          h('main', { className: "pt-24 pb-12 px-4 relative z-10" },
            h('div', { className: "max-w-6xl mx-auto" },

              // Landing State
              !state.result && !state.isLoading && h('div', { className: "flex flex-col items-center justify-center min-h-[60vh] text-center space-y-12 animate-fadeIn" },
                h('div', { className: "space-y-4 max-w-2xl" },
                  h('h1', { className: "text-5xl md:text-7xl font-bold tracking-tight text-white mb-6" },
                    "Decode ", h('br'),
                    h('span', { className: "text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400" }, "The Machine")
                  ),
                  h('p', { className: "text-xl text-slate-400 leading-relaxed" },
                    "Upload a photo of any circuit board or electronic device. Identify components, learn how they work, and find parts to harvest for your next project."
                  ),
                  h('div', { className: "flex items-center justify-center gap-4 flex-wrap" },
                    h('div', { className: "flex items-center gap-2 text-sm text-slate-500 bg-slate-800/50 py-2 px-4 rounded-full border border-slate-700" },
                      h(Icons.Database, { className: "w-3 h-3" }),
                      h('span', null, "Contrib. to Open Research")
                    ),
                    h('div', { className: "flex items-center gap-2 text-sm text-emerald-500/80 bg-emerald-900/10 py-2 px-4 rounded-full border border-emerald-500/20" },
                      h(Icons.ShieldCheck, { className: "w-3 h-3" }),
                      h('span', null, "Secure Scanning Active")
                    )
                  )
                ),

                // Two-button layout matching the real app
                h('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md" },
                  h('button', {
                    onClick: () => setShowCamera(true),
                    className: "group relative flex flex-col items-center justify-center p-8 bg-slate-800 border-2 border-slate-700 rounded-2xl hover:border-emerald-500 transition-all hover:shadow-[0_0_30px_rgba(16,185,129,0.15)]"
                  },
                    h('div', { className: "w-16 h-16 rounded-full bg-slate-900 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform" },
                      h(Icons.Camera, { className: "w-8 h-8 text-emerald-400" })
                    ),
                    h('span', { className: "text-lg font-bold text-white" }, "Scan Board"),
                    h('span', { className: "text-sm text-slate-400 mt-2" }, "Use Camera")
                  ),

                  h('button', {
                    onClick: handleFileUpload,
                    className: "group relative flex flex-col items-center justify-center p-8 bg-slate-800 border-2 border-slate-700 rounded-2xl hover:border-cyan-500 transition-all hover:shadow-[0_0_30px_rgba(6,182,212,0.15)]"
                  },
                    h('div', { className: "w-16 h-16 rounded-full bg-slate-900 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform" },
                      h(Icons.Upload, { className: "w-8 h-8 text-cyan-400" })
                    ),
                    h('span', { className: "text-lg font-bold text-white" }, "Upload Image"),
                    h('span', { className: "text-sm text-slate-400 mt-2" }, "From Gallery")
                  )
                ),

                h('div', { className: "text-sm text-slate-500 max-w-md text-center" },
                  h('p', null, "This demo uses pre-analyzed data from an Arduino UNO board. The full application uses Google's Gemini AI to analyze your own circuit board photos in real-time.")
                )
              ),

              // Loading State
              state.isLoading && h('div', { className: "flex flex-col items-center justify-center min-h-[60vh] space-y-8" },
                h('div', { className: "relative" },
                  h('div', { className: "w-24 h-24 rounded-full border-4 border-slate-800 border-t-emerald-500 animate-spin" }),
                  h('div', { className: "absolute inset-0 flex items-center justify-center" },
                    h(Icons.Cpu, { className: "w-8 h-8 text-emerald-500 animate-pulse" })
                  )
                ),
                h('div', { className: "text-center space-y-2" },
                  h('h3', { className: "text-2xl font-bold text-white" }, "Analyzing Circuitry..."),
                  h('p', { className: "text-slate-400" }, "Identifying components and reading labels"),
                  h('p', { className: "text-xs text-slate-600 mt-4" }, "Running security checks & sanitizing inputs")
                )
              ),

              // Results State
              state.result && h('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-8" },
                // Image Preview
                h('div', { className: "lg:col-span-1" },
                  h('div', { className: "sticky top-24" },
                    h('h4', { className: "text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2" },
                      h('span', { className: "w-2 h-2 rounded-full bg-emerald-500 animate-pulse" }),
                      "Detected Components"
                    ),
                    state.image && h(AnnotatedImage, {
                      imageSrc: state.image,
                      parts: state.result.parts,
                      onPartClick: scrollToPart
                    }),
                    h('p', { className: "text-xs text-slate-500 mt-3 text-center" }, "Click boxes to find details • Hover for names")
                  )
                ),

                // Analysis Content
                h('div', { className: "lg:col-span-2" },
                  h(AnalysisDisplay, { result: state.result })
                )
              )
            )
          ),

          // Camera Modal
          showCamera && h(CameraModal, {
            onClose: () => setShowCamera(false),
            onCapture: handleCameraCapture
          })
        );
      };

      // ============================================
      // RENDER THE APP
      // ============================================

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(h(React.StrictMode, null, h(App)));
    </script>
  </body>
</html>
